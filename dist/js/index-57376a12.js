import{E as d,p as te,k as ae,s as se,m as ne,e as re,A as ie,q as de,B as ue,C as me,r as fe,h as pe}from"./element-plus-28eabd23.js";import{_ as ce}from"./index-375f0060.js";import{d as _e,e as f,V as ve,f as ge,m as Ee,l as ye,o as v,c as w,U as l,a as t,M as a,a3 as m,u as o,i as be,L as A,Q as I,J as L,T as j,K as xe}from"./@vue-293b3db8.js";import{J as Ie,F as Ve,K as we,L as ke,H as z,M as Re}from"./@element-plus-51afdc8f.js";import{f as Ue,m as Te,n as Ae,o as Se}from"./index-5de9982a.js";import{s as he}from"./index-615793b3.js";import{_ as Ce}from"./_plugin-vue_export-helper-c27b6911.js";import"./dayjs-6997e6a6.js";import"./copy-to-clipboard-55affb02.js";import"./toggle-selection-93f4ad84.js";import"./lodash-es-327b7962.js";import"./async-validator-dee29e8b.js";import"./@ctrl-f8748455.js";import"./@popperjs-c75af06c.js";import"./@vueuse-9d87eeea.js";import"./index-f98d026c.js";import"./vue-router-3c7b10bc.js";import"./pinia-b73abff6.js";import"./vue-demi-71ba0ef2.js";import"./axios-b5ee139b.js";import"./nprogress-b52be870.js";import"./@codemirror-b3ba2dcc.js";import"./@lezer-5d82abd9.js";import"./crelt-7bb88e1d.js";import"./@marijn-45184d7f.js";import"./style-mod-ab9c37a6.js";import"./w3c-keyname-9fb136d3.js";const Be={class:"flex justify-center items-center"},Ne={class:"mt-6"},Fe={class:"dialog-footer"},De={class:"md:mt-16 mt-10 2xl:w-[100rem] w-full flex md:flex-row flex-col justify-center"},Le={class:"md:w-1/2 w-full"},je={class:"bg_card box_show w-full p-5 rounded shadow-slate-300"},ze={class:"flex justify-center mx-6"},Oe={class:"w-full mb-5"},Me={class:"flex justify-center"},Pe=["src"],$e={class:"flex justify-center"},Ze={class:"bg_card box_show w-full p-5 mt-5 rounded shadow-slate-300 mb-28"},qe={class:"flex justify-center"},Je={class:"w-full mb-5"},Ke={class:"flex justify-center mx-6"},He={class:"flex w-full"},Ye={class:"md:ml-10 md:w-[20rem] w-full p-5",style:{"min-height":"20px"}},Ge={key:0,class:"bg_card box_show rounded"},Qe={style:{"text-align":"center",padding:"15px 15px 10px 15px"}},We={style:{"font-weight":"bold"}},Xe={style:{"font-size":"14px",color:"grey",padding:"10px"}},eo={key:0,class:"mt-5 p-3 bg_card box_show rounded"},oo=_e({__name:"index",setup(lo){const S=f(),u=f({nickname:"",gender:void 0,intro:"",avatar:""}),p=f(),i=Ue(),r=ve({email:"",code:"",password:""});function h(){C.value.validate(s=>{s?Se(u.value).then(e=>{e.code==200?(d.success("信息更新成功"),i.getInfo()):d.error(e.data.msg)}):d.warning("请完整填写信息")})}const V=f(""),O=()=>{V.value!==p.value?S.value.submit():h()},M={VITE_APP_BASE_API:"/api",VITE_SERVE:"",VITE_FRONTEND_URL:"",VITE_MUSIC_BASE_API:"/wapi",VITE_MUSIC_SERVE:"",VITE_MUSIC_FRONTEND_URL:"",VITE_YIYAN_API:"",VITE_ENABLE_DEV_TOOLSBLOCKER:"true",VITE_USER_NODE_ENV:"production",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}.VITE_SERVE+"/api/user/auth/upload/avatar",P=localStorage.getItem("Token")||sessionStorage.getItem("Token")||"",$=s=>{if(s.code!==200){d.error("头像上传失败！"+s.msg);return}u.value.avatar=s.data,h(),V.value=p.value},Z=s=>(V.value=p.value,s.type!=="image/jpeg"&&s.type!=="image/png"?(d.error("头像图片需要jpg或者png类型的图片！！"),!1):s.size/1024/1024>2?(d.error("头像图片大小不能超过2MB！"),!1):!0),q=s=>{p.value=URL.createObjectURL(s.raw)};ge(()=>{Ee(()=>{i.userInfo&&(u.value=i.userInfo,p.value=i.userInfo.avatar,V.value=i.userInfo.avatar,r.email=i.userInfo.email)})});const J=(s,e,_)=>{e===""?_(new Error("请输入用户昵称")):/[a-zA-Z0-9\u4e00-\u9fa5]+$/.test(e)?_():_(new Error("用户名不能包含特殊字符，只能是中/英文"))},C=f(),k=f(),K={nickname:[{validator:J,trigger:["blur","change"]},{min:2,max:10,message:"用户昵称的长度必须在2-10个字符之间",trigger:["blur","change"]}]},H={email:[{required:!0,message:"请输入邮件地址",trigger:"blur"},{type:"email",message:"请输入合法的电子邮件地址",trigger:["blur","change"]}],code:[{required:!0,message:"请输入获取的验证码",trigger:"blur"}]},g=f(!1);function Y(){if(r.password===""){d.warning("密码不能为空");return}Te(r).then(s=>{s.code==200?(d.success("邮件地址更新成功"),r.code="",i.getInfo(),g.value=!1):d.error(s.msg)})}function G(){k.value.validate(s=>{s?g.value=!0:d.warning("请完整填写信息")})}function Q(){k.value.validate(s=>{s?(r.password="第三方登录",Ae(r).then(e=>{e.code==200?(d.success("邮件地址更新成功"),r.code="",i.getInfo()):d.error(e.msg)})):d.warning("请完整填写信息")})}const B=ye(()=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(r.email)),c=f(0);function W(){var s;if(r.email===((s=i.userInfo)==null?void 0:s.email)){d.warning("邮件地址未更改");return}B&&(c.value=60,he(r.email,"resetEmail").then(e=>{if(e.code==200){d.success(`验证码已发送到邮箱：${r.email}，请注意查收`);const _=setInterval(()=>{c.value===0?clearInterval(_):c.value--},1e3)}else d.error(e.msg),c.value=0}))}return(s,e)=>{var F;const _=ce,y=te,E=ae,X=se,R=ne,U=re,ee=ie,b=de,T=ue,oe=me,N=fe,le=pe;return v(),w(xe,null,[l(_),t("div",Be,[l(X,{modelValue:o(g),"onUpdate:modelValue":e[2]||(e[2]=n=>be(g)?g.value=n:null),title:"帐号安全验证",width:"500","align-center":""},{footer:a(()=>[t("div",Fe,[l(E,{onClick:e[1]||(e[1]=n=>g.value=!1)},{default:a(()=>[...e[9]||(e[9]=[m("关闭",-1)])]),_:1}),l(E,{type:"primary",onClick:Y,icon:o(Ie)},{default:a(()=>[...e[10]||(e[10]=[m(" 更新邮件 ",-1)])]),_:1},8,["icon"])])]),default:a(()=>[e[11]||(e[11]=t("span",{class:"font-bold"},"你正在进行敏感操作, 继续操作前请验证您的身份",-1)),t("div",Ne,[e[8]||(e[8]=t("span",{class:"font-bold"},"密码验证",-1)),l(y,{modelValue:o(r).password,"onUpdate:modelValue":e[0]||(e[0]=n=>o(r).password=n),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])])]),_:1},8,["modelValue"]),t("div",De,[t("div",Le,[t("div",je,[t("div",null,[l(R,null,{default:a(()=>[l(o(Ve))]),_:1}),e[12]||(e[12]=t("span",{class:"font-bold text-xl ml-2"},"账号信息设置",-1))]),e[17]||(e[17]=t("span",{style:{color:"gray","font-size":"0.8rem"}},"在这里可以编辑你的个人信息，个人简介等等……",-1)),l(U,{style:{"margin-top":"0.5rem"}}),t("div",ze,[t("div",Oe,[t("div",Me,[l(ee,{class:"avatar-uploader",action:o(M),"show-file-list":!1,"on-success":$,"before-upload":Z,"on-change":q,headers:{Authorization:"Bearer "+JSON.parse(o(P)).token},"auto-upload":!1,ref_key:"uploadRef",ref:S,name:"avatarFile"},{default:a(()=>[o(p)?(v(),w("img",{key:0,src:o(p),class:"avatar",alt:"头像",style:{"border-radius":"50%"}},null,8,Pe)):(v(),A(R,{key:1,class:"avatar-uploader-icon"},{default:a(()=>[l(o(we))]),_:1}))]),_:1},8,["action","headers"])]),t("div",$e,[l(N,{"label-position":"top","label-width":"auto",class:"w-full mt-5",model:o(u),ref_key:"baseFormRef",ref:C,rules:K},{default:a(()=>[l(b,{label:"用户昵称",prop:"nickname"},{default:a(()=>[l(y,{placeholder:"请输入用户昵称",maxlength:"10",modelValue:o(u).nickname,"onUpdate:modelValue":e[3]||(e[3]=n=>o(u).nickname=n)},null,8,["modelValue"])]),_:1}),l(b,{label:"性别"},{default:a(()=>[l(oe,{modelValue:o(u).gender,"onUpdate:modelValue":e[4]||(e[4]=n=>o(u).gender=n)},{default:a(()=>[l(T,{label:1},{default:a(()=>[...e[13]||(e[13]=[m("男",-1)])]),_:1}),l(T,{label:2},{default:a(()=>[...e[14]||(e[14]=[m("女",-1)])]),_:1}),l(T,{label:0},{default:a(()=>[...e[15]||(e[15]=[m("保密",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"个人简介"},{default:a(()=>[l(y,{type:"textarea",placeholder:"请输入个人简介",modelValue:o(u).intro,"onUpdate:modelValue":e[5]||(e[5]=n=>o(u).intro=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),l(E,{type:"success",icon:o(ke),onClick:O},{default:a(()=>[...e[16]||(e[16]=[m("更新信息",-1)])]),_:1},8,["icon"])])])]),t("div",Ze,[t("div",null,[l(R,null,{default:a(()=>[l(o(z))]),_:1}),e[18]||(e[18]=t("span",{class:"font-bold text-xl ml-2"},"电子邮件设置",-1))]),e[21]||(e[21]=t("span",{style:{color:"gray","font-size":"0.8rem"}},"在这里可以修改或绑定的电子邮箱信息，绑定后可以开启邮箱提醒！",-1)),l(U,{style:{"margin-top":"0.5rem"}}),t("div",qe,[t("div",Je,[t("div",Ke,[l(N,{"label-position":"top","label-width":"auto",class:"w-full mt-5",model:o(r),ref_key:"emailFormRef",ref:k,rules:H},{default:a(()=>[l(b,{label:"电子邮件",prop:"email"},{default:a(()=>[l(y,{placeholder:"请输入电子邮件",modelValue:o(r).email,"onUpdate:modelValue":e[6]||(e[6]=n=>o(r).email=n)},null,8,["modelValue"])]),_:1}),l(b,{prop:"code"},{default:a(()=>[t("div",He,[l(y,{placeholder:"请获取验证码",modelValue:o(r).code,"onUpdate:modelValue":e[7]||(e[7]=n=>o(r).code=n)},null,8,["modelValue"]),l(E,{type:"success",onClick:W,plain:"",class:"ml-2",disabled:!o(B)||o(c)!=0},{default:a(()=>[m(I(o(c)>0?`请稍后 ${o(c)} 秒`:"获取验证码"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["model"])]),((F=o(i).userInfo)==null?void 0:F.registerType)===0?(v(),A(E,{key:0,class:"mx-6",icon:o(Re),type:"success",onClick:G},{default:a(()=>[...e[19]||(e[19]=[m("安全验证",-1)])]),_:1},8,["icon"])):(v(),A(E,{key:1,class:"mx-6",icon:o(z),type:"success",onClick:Q},{default:a(()=>[...e[20]||(e[20]=[m("确定",-1)])]),_:1},8,["icon"]))])])])]),t("div",Ye,[l(j,{name:"el-fade-in-linear"},{default:a(()=>{var n,x,D;return[o(i).userInfo?(v(),w("div",Ge,[t("div",Qe,[l(le,{size:70,src:(n=o(i).userInfo)==null?void 0:n.avatar},null,8,["src"]),t("div",We," 你好，"+I((x=o(i).userInfo)==null?void 0:x.nickname),1),l(U,{style:{margin:"10px 0"}}),t("div",Xe,I(((D=o(i).userInfo)==null?void 0:D.intro)||"这个用户很懒，没有填写个人简介~"),1)])])):L("",!0)]}),_:1}),l(j,{name:"el-fade-in-linear"},{default:a(()=>{var n,x;return[o(i).userInfo?(v(),w("div",eo,[e[22]||(e[22]=t("div",{class:"text-gray-400 font-bold"}," 欢迎加入Ruyu个人博客！ ",-1)),t("div",null,"注册时间："+I((n=o(i).userInfo)==null?void 0:n.createTime),1),t("div",null,"登录时间："+I((x=o(i).userInfo)==null?void 0:x.loginTime),1)])):L("",!0)]}),_:1})])])])],64)}}});const Co=Ce(oo,[["__scopeId","data-v-59b71d2e"]]);export{Co as default};
