import{d as N,e as d,l as F,f as te,G as ne,o as i,c as u,a,E as G,D as S,P as Y,J as T,K as B,aj as z,Q as L,w as oe,al as ce,U as H,R as Q,u as Z}from"./@vue-293b3db8.js";import{_ as O}from"./_plugin-vue_export-helper-c27b6911.js";import{u as de}from"./@vueuse-9d87eeea.js";import{h as ve}from"./index-5de9982a.js";import"./pinia-b73abff6.js";import"./vue-demi-71ba0ef2.js";import"./axios-b5ee139b.js";import"./nprogress-b52be870.js";import"./copy-to-clipboard-55affb02.js";import"./toggle-selection-93f4ad84.js";import"./element-plus-28eabd23.js";import"./dayjs-6997e6a6.js";import"./lodash-es-327b7962.js";import"./@element-plus-51afdc8f.js";import"./async-validator-dee29e8b.js";import"./@ctrl-f8748455.js";import"./@popperjs-c75af06c.js";import"./vue-router-3c7b10bc.js";import"./@codemirror-b3ba2dcc.js";import"./@lezer-5d82abd9.js";import"./crelt-7bb88e1d.js";import"./@marijn-45184d7f.js";import"./style-mod-ab9c37a6.js";import"./w3c-keyname-9fb136d3.js";const he={class:"preview-image-container"},pe=["src"],R=.1,j=10,me=.002,ge=N({__name:"PhotoPreview",props:{show:{type:Boolean},photos:{},currentIndex:{}},emits:["update:show","update:currentIndex"],setup(X,{emit:v}){const r=X,h=v,p=d(1),_=d(0),g=d(!1),$=d(!1),f=d(0),w=d(0),y=d(!1),I=d(0),D=d(0),x=d(0),P=d(0),M=d(0),E=d(1),b=d(!1),l=d(""),e=F(()=>p.value===1&&_.value===0&&!g.value&&!$.value&&f.value===0&&w.value===0),t=()=>{p.value=1,_.value=0,g.value=!1,$.value=!1,f.value=0,w.value=0},n=()=>{t();const s=parseInt(document.body.style.top||"0")*-1;document.body.style.position="",document.body.style.width="",document.body.style.top="",document.body.style.left="",document.body.style.marginTop="",document.body.style.overflow="",window.scrollTo(0,s),h("update:show",!1)},o=()=>{if(b.value)return;b.value=!0,l.value="prev",t();const s=r.currentIndex>0?r.currentIndex-1:r.photos.length-1;h("update:currentIndex",s),setTimeout(()=>{l.value="",b.value=!1},300)},c=()=>{if(b.value)return;b.value=!0,l.value="next",t();const s=r.currentIndex<r.photos.length-1?r.currentIndex+1:0;h("update:currentIndex",s),setTimeout(()=>{l.value="",b.value=!1},300)},C=()=>{p.value=Math.min(p.value*1.2,j)},m=()=>{p.value=Math.max(p.value/1.2,R)},U=()=>{_.value-=90},K=()=>{_.value+=90},ae=()=>{g.value=!g.value},le=()=>{$.value=!$.value},V=s=>{r.show&&(s.key==="Escape"?n():s.key==="ArrowLeft"?o():s.key==="ArrowRight"?c():s.key==="+"||s.key==="="?C():s.key==="-"?m():s.key==="r"?K():s.key==="R"?U():s.key==="0"&&t())},se=s=>{y.value=!0,I.value=s.clientX,D.value=s.clientY,x.value=f.value,P.value=w.value},W=s=>{if(!y.value)return;const k=s.clientX-I.value,A=s.clientY-D.value;e.value&&p.value===1?Math.abs(k)>50&&(k>0?o():c(),y.value=!1):(f.value=x.value+k,w.value=P.value+A)},q=()=>{y.value=!1},re=s=>{s.touches.length===1?(y.value=!0,I.value=s.touches[0].clientX,D.value=s.touches[0].clientY,x.value=f.value,P.value=w.value):s.touches.length===2&&(M.value=Math.hypot(s.touches[0].clientX-s.touches[1].clientX,s.touches[0].clientY-s.touches[1].clientY),E.value=p.value)},ie=s=>{if(s.touches.length===1&&y.value){const k=s.touches[0].clientX-I.value,A=s.touches[0].clientY-D.value;e.value&&p.value===1?Math.abs(k)>50&&(k>0?o():c(),y.value=!1):(f.value=x.value+k,w.value=P.value+A)}else if(s.touches.length===2){const A=Math.hypot(s.touches[0].clientX-s.touches[1].clientX,s.touches[0].clientY-s.touches[1].clientY)/M.value;p.value=Math.min(Math.max(E.value*A,R),j)}},J=()=>{y.value=!1},ue=s=>{s.preventDefault();const k=-s.deltaY*me,A=p.value*(1+k);p.value=Math.min(Math.max(A,R),j)};return te(()=>{window.addEventListener("mousemove",W),window.addEventListener("mouseup",q),window.addEventListener("keydown",V)}),ne(()=>{window.removeEventListener("mousemove",W),window.removeEventListener("mouseup",q),window.removeEventListener("keydown",V)}),(s,k)=>s.show?(i(),u("div",{key:0,class:"preview-modal",onClick:n},[a("button",{class:"close-btn",onClick:n},"×"),a("div",{class:"preview-content",onClick:k[1]||(k[1]=Y(()=>{},["stop"]))},[a("div",he,[a("div",{class:"drag-container",style:G({transform:`translate(${f.value}px, ${w.value}px)`})},[(i(),u("img",{key:s.currentIndex,src:s.photos[s.currentIndex],style:G({transform:`scale(${p.value}) rotate(${_.value}deg) 
                         scaleX(${g.value?-1:1}) scaleY(${$.value?-1:1})`,transformOrigin:"center",transition:"transform 0.3s ease"}),class:S(["preview-image",l.value==="prev"?"slide-prev":"",l.value==="next"?"slide-next":""]),onMousedown:se,onWheel:Y(ue,["prevent"]),onTouchstart:Y(re,["prevent"]),onTouchmove:Y(ie,["prevent"]),onTouchend:Y(J,["prevent"]),onTouchcancel:Y(J,["prevent"]),onDragstart:k[0]||(k[0]=Y(()=>{},["prevent"])),draggable:"false",alt:"预览图片"},null,46,pe))],4)]),a("div",{class:"preview-toolbar"},[a("div",{class:"toolbar-group"},[a("button",{class:"preview-btn",onClick:o,title:"上一张"},"◀"),a("button",{class:"preview-btn",onClick:c,title:"下一张"},"▶")]),a("div",{class:"toolbar-group"},[a("button",{class:"preview-btn",onClick:C,title:"放大"},"+"),a("button",{class:"preview-btn",onClick:m,title:"缩小"},"-"),a("button",{class:"preview-btn",onClick:U,title:"向左旋转"},"↺"),a("button",{class:"preview-btn",onClick:K,title:"向右旋转"},"↻"),a("button",{class:"preview-btn",onClick:ae,title:"水平翻转"},"↔"),a("button",{class:"preview-btn",onClick:le,title:"垂直翻转"},"↕"),a("button",{class:"preview-btn",onClick:t,title:"重置"},"⟲")])])])])):T("",!0)}});const ye=O(ge,[["__scopeId","data-v-d4557086"]]),fe={class:"breadcrumb-nav"},be=["onClick"],_e={class:"banner-content"},ke={class:"banner-text"},we={class:"banner-title"},Pe={key:0,class:"banner-description"},Ce={class:"banner-stats"},$e={class:"stats-group"},xe={key:0,class:"stats-item photos-count"},Me={key:1,class:"stats-item albums-count"},Ie=N({__name:"AlbumBanner",props:{title:{},description:{},coverImage:{},photosCount:{},albumsCount:{},breadcrumbs:{},isDarkMode:{type:Boolean}},emits:["breadcrumbClick"],setup(X,{emit:v}){const r=v,h=X;return(p,_)=>(i(),u("div",{class:S(["album-banner",{"dark-mode":h.isDarkMode}])},[a("div",{class:"banner-background",style:G({backgroundImage:h.coverImage?`url(${h.coverImage})`:"linear-gradient(45deg, #2c3e50, #3498db)"})},null,4),a("div",fe,[a("span",{class:"breadcrumb-item home",onClick:_[0]||(_[0]=g=>r("breadcrumbClick",-1))},"首页"),(i(!0),u(B,null,z(h.breadcrumbs,(g,$)=>(i(),u(B,{key:g.id},[_[1]||(_[1]=a("span",{class:"breadcrumb-separator"},"/",-1)),a("span",{class:"breadcrumb-item",onClick:f=>r("breadcrumbClick",$)},L(g.name),9,be)],64))),128))]),a("div",_e,[a("div",ke,[a("h1",we,L(h.title),1),h.description?(i(),u("p",Pe,L(h.description),1)):T("",!0),a("div",Ce,[a("div",$e,[h.photosCount!==void 0?(i(),u("span",xe,L(h.photosCount)+" 张照片 ",1)):T("",!0),h.albumsCount!==void 0?(i(),u("span",Me,L(h.albumsCount)+" 个相册 ",1)):T("",!0)])])])])],2))}});const De=O(Ie,[["__scopeId","data-v-187ae906"]]),Se={class:"gallery-wrapper"},Te={key:0,class:"loading-state"},Ye={key:0,class:"gallery-grid"},Le=["onClick"],Xe={key:0,class:"default-album-cover"},Be=["data-src","alt"],Ae=["data-src","alt"],Ee={key:2,class:"item-info"},Ge={key:1,class:"empty-state"},Ue={key:2,class:"loading-more"},ze={key:0,class:"loading-spinner"},Fe={key:1},Ne=N({__name:"PhotoGallery",props:{currentPath:{},galleries:{},isDarkMode:{type:Boolean},loading:{type:Boolean},hasMore:{type:Boolean}},emits:["update:currentPath","loadMore"],setup(X,{emit:v}){const r=X,h=v,p=d(!1),_=d(0),g=d([]),$=e=>{if(b(e)){const t=window.scrollY;document.body.style.position="fixed",document.body.style.width="100%",document.body.style.top=`-${t}px`,document.body.style.overflow="hidden",document.body.style.left="0",document.body.style.marginTop="0";const n=y().filter(b).map(o=>o.data.url);g.value=n,_.value=n.indexOf(e.data.url),p.value=!0}else l(e)&&h("update:currentPath",[...r.currentPath,e.data.id])},f=d([]),w=d(0),y=()=>{const e=r.currentPath.length===0?"root":r.currentPath[r.currentPath.length-1].toString();return r.galleries[e]||[]},I=(e=0)=>{const t=y();f.value.length<t.length&&(f.value=[...f.value,...new Array(t.length-f.value.length).fill(!1)]),requestAnimationFrame(()=>{for(let n=e;n<t.length;n++)setTimeout(()=>{f.value[n]=!0},(n-e)*100)})},D=()=>{const e=window.scrollY+window.innerHeight,t=document.documentElement.scrollHeight;!r.loading&&r.hasMore&&t-e<=100&&h("loadMore")};te(()=>{I(),window.addEventListener("scroll",D)}),ne(()=>{document.body.style.position="",document.body.style.width="",document.body.style.top="",document.body.style.overflow="",document.body.style.left="",document.body.style.marginTop="",window.removeEventListener("scroll",D)}),oe(()=>[r.currentPath,r.galleries],(e,t)=>{const n=y();(t&&t[0]?r.currentPath.length!==t[0].length||r.currentPath.some((c,C)=>c!==t[0][C])||r.currentPath.length===0&&t[0].length>0:!1)?(window.scrollTo({top:0,behavior:"smooth"}),f.value=new Array(n.length).fill(!1),I(0)):n.length>w.value&&I(w.value),w.value=n.length},{deep:!0,immediate:!0});const x=e=>l(e)?e.data.photos.length>0||!!e.data.coverUrl:!1,P=F(()=>{const e=r.currentPath.length===0?"root":r.currentPath[r.currentPath.length-1].toString(),t=r.galleries[e]||[];let n;if(e==="root"){const o=t.find(c=>b(c));return{title:"我的相册",description:"相册功能正在测试阶段，图片来源于网络，如有侵权请联系我！！！",photosCount:t.filter(c=>b(c)).length,albumsCount:t.filter(c=>l(c)).length,coverImage:o?o.data.url:void 0}}else{const o=r.currentPath.length>1?r.currentPath[r.currentPath.length-2].toString():"root";n=(r.galleries[o]||[]).find(m=>l(m)&&m.data.id===Number(e));const C=t.find(m=>b(m));return{title:(n==null?void 0:n.data.name)||"未命名相册",description:(n==null?void 0:n.data.description)||"",photosCount:t.filter(m=>b(m)).length,albumsCount:t.filter(m=>l(m)).length,coverImage:C?C.data.url:void 0}}}),M=F(()=>r.currentPath.map((e,t)=>{const n=t===0?"root":r.currentPath[t-1].toString(),c=(r.galleries[n]||[]).find(C=>l(C)&&C.data.id===e);return{id:e,name:c?c.data.name:"未命名相册"}})),E=e=>{e===-1?h("update:currentPath",[]):h("update:currentPath",r.currentPath.slice(0,e+1))},b=e=>e.type==="photo",l=e=>e.type==="album";return(e,t)=>{const n=ce("lazy");return i(),u("div",{class:S(["photo-gallery",{"dark-mode":e.isDarkMode}])},[H(De,{title:P.value.title,description:P.value.description,"photos-count":P.value.photosCount,"albums-count":P.value.albumsCount,"cover-image":P.value.coverImage,breadcrumbs:M.value,"is-dark-mode":e.isDarkMode,onBreadcrumbClick:E},null,8,["title","description","photos-count","albums-count","cover-image","breadcrumbs","is-dark-mode"]),a("div",Se,[r.loading&&y().length===0?(i(),u("div",Te,[...t[2]||(t[2]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"加载中...",-1)])])):(i(),u(B,{key:1},[y().length>0?(i(),u("div",Ye,[(i(!0),u(B,null,z(y(),(o,c)=>(i(),u("div",{key:o.type+(b(o),o.data.id),class:S(["gallery-item",{visible:f.value[c]}]),onClick:C=>$(o)},[l(o)?(i(),u(B,{key:0},[!x(o)&&!o.data.coverUrl?(i(),u("div",Xe,[...t[3]||(t[3]=[a("div",{class:"default-album-inner"},[a("div",{class:"album-icon"})],-1)])])):Q((i(),u("img",{key:1,"data-src":o.data.coverUrl||"/images/default-album-cover.jpg",alt:o.data.name},null,8,Be)),[[n,!0]])],64)):b(o)?Q((i(),u("img",{key:1,"data-src":o.data.url,alt:o.data.title},null,8,Ae)),[[n,!0]]):T("",!0),l(o)?(i(),u("div",Ee,[a("h3",null,L(o.data.name),1)])):T("",!0)],10,Le))),128))])):(i(),u("div",Ge,[...t[4]||(t[4]=[a("p",null,"这个相册还没有内容哦~",-1)])])),r.hasMore&&y().length>0?(i(),u("div",Ue,[r.loading?(i(),u("div",ze)):(i(),u("p",Fe,"向下滚动加载更多"))])):T("",!0)],64))]),H(ye,{show:p.value,"onUpdate:show":t[0]||(t[0]=o=>p.value=o),currentIndex:_.value,"onUpdate:currentIndex":t[1]||(t[1]=o=>_.value=o),photos:g.value},null,8,["show","currentIndex","photos"])],2)}}});const Oe=O(Ne,[["__scopeId","data-v-416bd5d3"]]);function Re(X){return ve({url:"/photo/list",method:"get",params:X})}const je={class:"header"},He={class:"header-content"},Ke={class:"main-content"},Ve={class:"album-tree"},We=["onClick"],qe={class:"album-name"},Je={key:0,class:"sub-albums"},Qe=["onClick"],Ze={class:"album-name"},et={key:0,class:"sub-albums"},tt=["onClick"],nt={class:"album-name"},ot={class:"gallery-container"},ee=16,at=N({__name:"index",setup(X){const v=d([]),r=d(!1),h=d(1),p=d(!0),_=d(0),g=d({root:[]}),$=l=>l.map(e=>e.type===1?{type:"album",data:{id:e.id,name:e.name,description:e.description||"",photos:[],coverUrl:e.url}}:{type:"photo",data:{id:e.id,url:e.url||"",title:e.name,description:e.description||""}}),f=async(l,e=1,t=!1)=>{try{r.value=!0;const n=await Re({pageNum:e,pageSize:ee,parentId:l||null}),o=l?l.toString():"root",c=$(n.data.page);t?g.value[o]=[...g.value[o]||[],...c]:g.value[o]=c,_.value=n.data.total,p.value=e*ee<n.data.total,h.value=e}catch(n){console.error("加载相册数据失败:",n)}finally{r.value=!1}},w=async()=>{if(r.value||!p.value)return;const l=v.value.length>0?v.value[v.value.length-1]:void 0;await f(l,h.value+1,!0)};oe(()=>v.value,async l=>{const e=l.length>0?l[l.length-1]:void 0;h.value=1,p.value=!0,await f(e,1,!1)},{immediate:!0});const y=l=>{if(v.value[v.value.length-1]===l)return;const e=I(l);e?v.value=e:v.value=[l]},I=(l,e=[])=>{for(const t of g.value.root)if(t.type==="album"){const n=t.data;if(n.id===l)return[l];const o=D(n.id,l);if(o)return o}return null},D=(l,e)=>{const t=g.value[l.toString()];if(!t)return null;for(const n of t)if(n.type==="album"){const o=n.data;if(o.id===e)return[l,e];const c=D(o.id,e);if(c)return[l,...c]}return null},x=d(!1),P=l=>{x.value=l,l?document.body.style.overflow="hidden":document.body.style.overflow=""},M=()=>{P(!1)},E=F(()=>{const l=(e=null,t=0)=>{const n=[];for(const[o,c]of Object.entries(g.value)){const C=c.filter(m=>m.type==="album").map(m=>{const U=m.data;return{id:U.id,name:U.name}});for(const m of C)e===null&&o==="root"?n.push({id:m.id,name:m.name,children:l(m.id.toString(),t+1),level:t}):e===o&&n.push({id:m.id,name:m.name,children:l(m.id.toString(),t+1),level:t})}return n};return l()}),b=de();return(l,e)=>(i(),u("div",{class:S(["app-container",{"dark-mode":Z(b)}])},[a("header",je,[a("div",He,[a("button",{class:"menu-toggle",onClick:e[0]||(e[0]=t=>P(!x.value))},[...e[3]||(e[3]=[a("span",{class:"menu-icon"},null,-1)])])])]),a("main",Ke,[a("aside",{class:S(["album-menu",{"mobile-open":x.value}])},[a("div",{class:"menu-header"},[e[4]||(e[4]=a("h2",null,"相册列表",-1)),a("button",{class:"close-menu",onClick:M},"×")]),a("ul",Ve,[a("li",{class:S(["home-item",{active:v.value.length===0}]),onClick:e[1]||(e[1]=t=>{v.value=[],M()})}," 主页 ",2),(i(!0),u(B,null,z(E.value,t=>(i(),u("li",{key:t.id,class:S(["album-tree-item",{active:v.value[v.value.length-1]===t.id,"has-children":t.children.length>0,expanded:v.value.includes(t.id)}]),style:G({paddingLeft:`${t.level*16}px`}),onClick:n=>{y(t.id),M()}},[a("span",qe,L(t.name),1),t.children.length>0?(i(),u("ul",Je,[(i(!0),u(B,null,z(t.children,n=>(i(),u("li",{key:n.id,class:S(["album-tree-item",{active:v.value[v.value.length-1]===n.id,"has-children":n.children.length>0,expanded:v.value.includes(n.id)}]),style:G({paddingLeft:`${n.level*16}px`}),onClick:Y(o=>{y(n.id),M()},["stop"])},[a("span",Ze,L(n.name),1),n.children.length>0?(i(),u("ul",et,[(i(!0),u(B,null,z(n.children,o=>(i(),u("li",{key:o.id,class:S(["album-tree-item",{active:v.value[v.value.length-1]===o.id}]),style:G({paddingLeft:`${o.level*16}px`}),onClick:Y(c=>{y(o.id),M()},["stop"])},[a("span",nt,L(o.name),1)],14,tt))),128))])):T("",!0)],14,Qe))),128))])):T("",!0)],14,We))),128))])],2),x.value?(i(),u("div",{key:0,class:"overlay",onClick:M})):T("",!0),a("div",ot,[H(Oe,{currentPath:v.value,"onUpdate:currentPath":e[2]||(e[2]=t=>v.value=t),galleries:g.value,"is-dark-mode":Z(b),loading:r.value,"has-more":p.value,onLoadMore:w},null,8,["currentPath","galleries","is-dark-mode","loading","has-more"])])])],2))}});const Dt=O(at,[["__scopeId","data-v-6aeeb036"]]);export{Dt as default};
